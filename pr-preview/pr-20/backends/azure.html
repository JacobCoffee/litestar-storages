<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Azure Blob Storage - litestar-storages</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Memory Storage" href="memory.html" /><link rel="prev" title="GCS Storage" href="gcs.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=14737038" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=5f8f7e8c" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="Azure Blob Storage"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>litestar-storages</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link">
          <a href="https://litestar.dev/">
            <span>Litestar</span></a>
        </li><li class="link">
          <a href="https://pypi.org/project/litestar-storages/">
            <span>PyPI</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/JacobCoffee/litestar-storages" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Example Applications</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Storage Backends</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="filesystem.html">FileSystem Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="s3.html">S3 Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="gcs.html">GCS Storage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Azure Blob Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory.html">Memory Storage</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Advanced Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../advanced/retry.html">Retry Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/multipart-uploads.html">Multipart Uploads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/progress-callbacks.html">Progress Callbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/custom-backends.html">Custom Backends</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Cookbook</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/index.html">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/file-upload-validation.html">File Upload with Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/image-processing-pipeline.html">Image Processing Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/multi-backend-config.html">Multi-Backend Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/streaming-large-files.html">Streaming Large Files</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/base.html">Base Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/backends/index.html">Storage Backends</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/backends/memory.html">Memory Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/backends/filesystem.html">FileSystem Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/backends/s3.html">S3 Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/backends/gcs.html">GCS Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/backends/azure.html">Azure Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/contrib/index.html">Litestar Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/contrib/plugin.html">Storage Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/contrib/dependencies.html">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/contrib/dto.html">DTOs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../comparison.html">Comparison with Other Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a><ul>
<li><a class="reference internal" href="#azureconfig-options">AzureConfig Options</a></li>
<li><a class="reference internal" href="#configuration-options">Configuration Options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#authentication-methods">Authentication Methods</a><ul>
<li><a class="reference internal" href="#connection-string">Connection String</a></li>
<li><a class="reference internal" href="#account-url-account-key">Account URL + Account Key</a></li>
<li><a class="reference internal" href="#defaultazurecredential-managed-identity">DefaultAzureCredential (Managed Identity)</a></li>
<li><a class="reference internal" href="#running-on-azure-auto-detection">Running on Azure (Auto-Detection)</a></li>
<li><a class="reference internal" href="#azurite-emulator-support">Azurite Emulator Support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage-examples">Usage Examples</a><ul>
<li><a class="reference internal" href="#basic-upload-and-download">Basic Upload and Download</a></li>
<li><a class="reference internal" href="#sas-url-generation">SAS URL Generation</a></li>
<li><a class="reference internal" href="#using-with-prefix">Using with Prefix</a></li>
<li><a class="reference internal" href="#streaming-large-files">Streaming Large Files</a></li>
<li><a class="reference internal" href="#copy-and-move-operations">Copy and Move Operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#azurite-emulator-setup">Azurite Emulator Setup</a><ul>
<li><a class="reference internal" href="#docker-setup">Docker Setup</a></li>
<li><a class="reference internal" href="#docker-compose">Docker Compose</a></li>
<li><a class="reference internal" href="#azurite-configuration">Azurite Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#best-practices">Best Practices</a><ul>
<li><a class="reference internal" href="#credential-management">Credential Management</a></li>
<li><a class="reference internal" href="#environment-variable-configuration">Environment Variable Configuration</a></li>
<li><a class="reference internal" href="#never-commit-credentials">Never Commit Credentials</a></li>
<li><a class="reference internal" href="#container-naming-rules">Container Naming Rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-handling">Error Handling</a><ul>
<li><a class="reference internal" href="#common-error-scenarios">Common Error Scenarios</a></li>
</ul>
</li>
<li><a class="reference internal" href="#azure-specific-considerations">Azure-Specific Considerations</a><ul>
<li><a class="reference internal" href="#delete-behavior">Delete Behavior</a></li>
<li><a class="reference internal" href="#sas-url-limitations">SAS URL Limitations</a></li>
<li><a class="reference internal" href="#blob-types">Blob Types</a></li>
</ul>
</li>
<li><a class="reference internal" href="#large-file-uploads">Large File Uploads</a><ul>
<li><a class="reference internal" href="#using-put-large">Using put_large()</a></li>
<li><a class="reference internal" href="#progress-tracking">Progress Tracking</a></li>
<li><a class="reference internal" href="#manual-multipart-upload">Manual Multipart Upload</a></li>
<li><a class="reference internal" href="#azure-block-blob-limits">Azure Block Blob Limits</a></li>
<li><a class="reference internal" href="#block-size-recommendations">Block Size Recommendations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">litestar-storages</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Azure Blob Storage</strong>
        <meta itemprop="position" content="2" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="azure-blob-storage">
<h1>Azure Blob Storage<a class="headerlink" href="#azure-blob-storage" title="Link to this heading">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">AzureStorage</span></code> backend stores files in Microsoft Azure Blob Storage. It supports SAS URL generation, server-side operations, and streaming for efficient handling of large files.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p>Install with the Azure extra:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">pip<span class="w"> </span>install<span class="w"> </span>litestar-storages<span class="o">[</span>azure<span class="o">]</span>
</span></pre></div>
</div>
<p>This installs <code class="docutils literal notranslate"><span class="pre">azure-storage-blob</span></code> for async blob operations. For managed identity authentication, you will also need <code class="docutils literal notranslate"><span class="pre">azure-identity</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">pip<span class="w"> </span>install<span class="w"> </span>litestar-storages<span class="o">[</span>azure<span class="o">]</span><span class="w"> </span>azure-identity
</span></pre></div>
</div>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h2>
<section id="azureconfig-options">
<h3>AzureConfig Options<a class="headerlink" href="#azureconfig-options" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timedelta</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_storages</span><span class="w"> </span><span class="kn">import</span> <span class="n">AzureStorage</span><span class="p">,</span> <span class="n">AzureConfig</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">config</span> <span class="o">=</span> <span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">container</span><span class="o">=</span><span class="s2">&quot;my-container&quot;</span><span class="p">,</span>                    <span class="c1"># Required: container name</span>
</span><span data-line="6">    <span class="n">account_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                            <span class="c1"># Optional: storage account URL</span>
</span><span data-line="7">    <span class="n">account_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                            <span class="c1"># Optional: storage account key</span>
</span><span data-line="8">    <span class="n">connection_string</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                      <span class="c1"># Optional: full connection string</span>
</span><span data-line="9">    <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>                                   <span class="c1"># Optional: key prefix for all operations</span>
</span><span data-line="10">    <span class="n">presigned_expiry</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>         <span class="c1"># Optional: default SAS URL expiration</span>
</span><span data-line="11"><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13"><span class="n">storage</span> <span class="o">=</span> <span class="n">AzureStorage</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="configuration-options">
<h3>Configuration Options<a class="headerlink" href="#configuration-options" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">container</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">str</span></code></p></td>
<td><p>Required</p></td>
<td><p>Azure Blob container name</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">account_url</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Storage account URL (e.g., <code class="docutils literal notranslate"><span class="pre">https://&lt;account&gt;.blob.core.windows.net</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">account_key</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Storage account access key</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">connection_string</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Full connection string (alternative to account_url + account_key)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">prefix</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">str</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p></td>
<td><p>Key prefix applied to all operations</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">presigned_expiry</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">timedelta</span></code></p></td>
<td><p>1 hour</p></td>
<td><p>Default expiration for SAS URLs</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="authentication-methods">
<h2>Authentication Methods<a class="headerlink" href="#authentication-methods" title="Link to this heading">¶</a></h2>
<p>Azure Storage supports several authentication methods. Choose the one that best fits your deployment scenario.</p>
<section id="connection-string">
<h3>Connection String<a class="headerlink" href="#connection-string" title="Link to this heading">¶</a></h3>
<p>The simplest method for development and testing. Find your connection string in the Azure Portal under Storage Account &gt; Access keys.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_storages</span><span class="w"> </span><span class="kn">import</span> <span class="n">AzureStorage</span><span class="p">,</span> <span class="n">AzureConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">storage</span> <span class="o">=</span> <span class="n">AzureStorage</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">config</span><span class="o">=</span><span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="5">        <span class="n">container</span><span class="o">=</span><span class="s2">&quot;my-container&quot;</span><span class="p">,</span>
</span><span data-line="6">        <span class="n">connection_string</span><span class="o">=</span><span class="s2">&quot;DefaultEndpointsProtocol=https;AccountName=myaccount;AccountKey=...;EndpointSuffix=core.windows.net&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="p">)</span>
</span><span data-line="8"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="account-url-account-key">
<h3>Account URL + Account Key<a class="headerlink" href="#account-url-account-key" title="Link to this heading">¶</a></h3>
<p>Explicit credential configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">storage</span> <span class="o">=</span> <span class="n">AzureStorage</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">config</span><span class="o">=</span><span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="3">        <span class="n">container</span><span class="o">=</span><span class="s2">&quot;my-container&quot;</span><span class="p">,</span>
</span><span data-line="4">        <span class="n">account_url</span><span class="o">=</span><span class="s2">&quot;https://myaccount.blob.core.windows.net&quot;</span><span class="p">,</span>
</span><span data-line="5">        <span class="n">account_key</span><span class="o">=</span><span class="s2">&quot;your-storage-account-key&quot;</span><span class="p">,</span>
</span><span data-line="6">    <span class="p">)</span>
</span><span data-line="7"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="defaultazurecredential-managed-identity">
<h3>DefaultAzureCredential (Managed Identity)<a class="headerlink" href="#defaultazurecredential-managed-identity" title="Link to this heading">¶</a></h3>
<p>When running on Azure infrastructure (App Service, Functions, AKS, VMs), use managed identity for secure, credential-free authentication:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># No account_key needed - uses DefaultAzureCredential</span>
</span><span data-line="2"><span class="n">storage</span> <span class="o">=</span> <span class="n">AzureStorage</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">config</span><span class="o">=</span><span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="4">        <span class="n">container</span><span class="o">=</span><span class="s2">&quot;my-container&quot;</span><span class="p">,</span>
</span><span data-line="5">        <span class="n">account_url</span><span class="o">=</span><span class="s2">&quot;https://myaccount.blob.core.windows.net&quot;</span><span class="p">,</span>
</span><span data-line="6">        <span class="c1"># account_key omitted - will use DefaultAzureCredential</span>
</span><span data-line="7">    <span class="p">)</span>
</span><span data-line="8"><span class="p">)</span>
</span></pre></div>
</div>
<p>This requires the <code class="docutils literal notranslate"><span class="pre">azure-identity</span></code> package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">pip<span class="w"> </span>install<span class="w"> </span>azure-identity
</span></pre></div>
</div>
<p>DefaultAzureCredential automatically tries multiple authentication methods in order:</p>
<ol class="arabic simple">
<li><p>Environment variables (<code class="docutils literal notranslate"><span class="pre">AZURE_CLIENT_ID</span></code>, <code class="docutils literal notranslate"><span class="pre">AZURE_CLIENT_SECRET</span></code>, <code class="docutils literal notranslate"><span class="pre">AZURE_TENANT_ID</span></code>)</p></li>
<li><p>Managed Identity (system-assigned or user-assigned)</p></li>
<li><p>Azure CLI credentials</p></li>
<li><p>Azure PowerShell credentials</p></li>
<li><p>Visual Studio Code credentials</p></li>
</ol>
</section>
<section id="running-on-azure-auto-detection">
<h3>Running on Azure (Auto-Detection)<a class="headerlink" href="#running-on-azure-auto-detection" title="Link to this heading">¶</a></h3>
<p>When deployed to Azure services with managed identity enabled, authentication is automatic:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">storage</span> <span class="o">=</span> <span class="n">AzureStorage</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">config</span><span class="o">=</span><span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="5">        <span class="n">container</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_STORAGE_CONTAINER&quot;</span><span class="p">],</span>
</span><span data-line="6">        <span class="n">account_url</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_STORAGE_ACCOUNT_URL&quot;</span><span class="p">],</span>
</span><span data-line="7">        <span class="c1"># Credentials automatically discovered from managed identity</span>
</span><span data-line="8">    <span class="p">)</span>
</span><span data-line="9"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Required Azure RBAC role:</strong> Assign “Storage Blob Data Contributor” to your managed identity:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Using Azure CLI</span>
</span><span data-line="2">az<span class="w"> </span>role<span class="w"> </span>assignment<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">    </span>--assignee<span class="w"> </span>&lt;managed-identity-principal-id&gt;<span class="w"> </span><span class="se">\</span>
</span><span data-line="4"><span class="w">    </span>--role<span class="w"> </span><span class="s2">&quot;Storage Blob Data Contributor&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="5"><span class="w">    </span>--scope<span class="w"> </span>/subscriptions/&lt;subscription-id&gt;/resourceGroups/&lt;resource-group&gt;/providers/Microsoft.Storage/storageAccounts/&lt;storage-account&gt;
</span></pre></div>
</div>
</section>
<section id="azurite-emulator-support">
<h3>Azurite Emulator Support<a class="headerlink" href="#azurite-emulator-support" title="Link to this heading">¶</a></h3>
<p>For local development without an Azure subscription, use the Azurite emulator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Azurite default credentials</span>
</span><span data-line="2"><span class="n">storage</span> <span class="o">=</span> <span class="n">AzureStorage</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">config</span><span class="o">=</span><span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="4">        <span class="n">container</span><span class="o">=</span><span class="s2">&quot;test-container&quot;</span><span class="p">,</span>
</span><span data-line="5">        <span class="n">connection_string</span><span class="o">=</span><span class="p">(</span>
</span><span data-line="6">            <span class="s2">&quot;DefaultEndpointsProtocol=http;&quot;</span>
</span><span data-line="7">            <span class="s2">&quot;AccountName=devstoreaccount1;&quot;</span>
</span><span data-line="8">            <span class="s2">&quot;AccountKey=Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==;&quot;</span>
</span><span data-line="9">            <span class="s2">&quot;BlobEndpoint=http://127.0.0.1:10000/devstoreaccount1&quot;</span>
</span><span data-line="10">        <span class="p">),</span>
</span><span data-line="11">    <span class="p">)</span>
</span><span data-line="12"><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="usage-examples">
<h2>Usage Examples<a class="headerlink" href="#usage-examples" title="Link to this heading">¶</a></h2>
<section id="basic-upload-and-download">
<h3>Basic Upload and Download<a class="headerlink" href="#basic-upload-and-download" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">post</span><span class="p">,</span> <span class="n">get</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.datastructures</span><span class="w"> </span><span class="kn">import</span> <span class="n">UploadFile</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_storages</span><span class="w"> </span><span class="kn">import</span> <span class="n">Storage</span>
</span><span data-line="4">
</span><span data-line="5">
</span><span data-line="6"><span class="nd">@post</span><span class="p">(</span><span class="s2">&quot;/upload&quot;</span><span class="p">)</span>
</span><span data-line="7"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">upload_file</span><span class="p">(</span>
</span><span data-line="8">    <span class="n">data</span><span class="p">:</span> <span class="n">UploadFile</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">storage</span><span class="p">:</span> <span class="n">Storage</span><span class="p">,</span>
</span><span data-line="10"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span data-line="11"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Upload a file to Azure Blob Storage.&quot;&quot;&quot;</span>
</span><span data-line="12">    <span class="n">content</span> <span class="o">=</span> <span class="k">await</span> <span class="n">data</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span data-line="13">
</span><span data-line="14">    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
</span><span data-line="15">        <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;uploads/</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span data-line="16">        <span class="n">data</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
</span><span data-line="17">        <span class="n">content_type</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">content_type</span><span class="p">,</span>
</span><span data-line="18">        <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="19">            <span class="s2">&quot;original-name&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
</span><span data-line="20">            <span class="s2">&quot;uploaded-by&quot;</span><span class="p">:</span> <span class="s2">&quot;user-123&quot;</span><span class="p">,</span>
</span><span data-line="21">        <span class="p">},</span>
</span><span data-line="22">    <span class="p">)</span>
</span><span data-line="23">
</span><span data-line="24">    <span class="k">return</span> <span class="p">{</span>
</span><span data-line="25">        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span data-line="26">        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span data-line="27">        <span class="s2">&quot;content_type&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">content_type</span><span class="p">,</span>
</span><span data-line="28">    <span class="p">}</span>
</span><span data-line="29">
</span><span data-line="30">
</span><span data-line="31"><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/files/{key:path}&quot;</span><span class="p">)</span>
</span><span data-line="32"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_file</span><span class="p">(</span>
</span><span data-line="33">    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="34">    <span class="n">storage</span><span class="p">:</span> <span class="n">Storage</span><span class="p">,</span>
</span><span data-line="35"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span data-line="36"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Download a file from Azure Blob Storage.&quot;&quot;&quot;</span>
</span><span data-line="37">    <span class="k">return</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="sas-url-generation">
<h3>SAS URL Generation<a class="headerlink" href="#sas-url-generation" title="Link to this heading">¶</a></h3>
<p>SAS (Shared Access Signature) URLs provide time-limited access to private blobs without exposing credentials.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timedelta</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Use default expiration (from config)</span>
</span><span data-line="4"><span class="n">url</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="s2">&quot;documents/report.pdf&quot;</span><span class="p">)</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Custom expiration</span>
</span><span data-line="7"><span class="n">url</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">url</span><span class="p">(</span>
</span><span data-line="8">    <span class="s2">&quot;documents/report.pdf&quot;</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">expires_in</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span>
</span><span data-line="10"><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># Long-lived URL (use sparingly)</span>
</span><span data-line="13"><span class="n">url</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">url</span><span class="p">(</span>
</span><span data-line="14">    <span class="s2">&quot;public/image.jpg&quot;</span><span class="p">,</span>
</span><span data-line="15">    <span class="n">expires_in</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span>
</span><span data-line="16"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>SAS URL Patterns:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">Redirect</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_storages</span><span class="w"> </span><span class="kn">import</span> <span class="n">Storage</span>
</span><span data-line="4">
</span><span data-line="5">
</span><span data-line="6"><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/files/{key:path}/download-url&quot;</span><span class="p">)</span>
</span><span data-line="7"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_download_url</span><span class="p">(</span>
</span><span data-line="8">    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">storage</span><span class="p">:</span> <span class="n">Storage</span><span class="p">,</span>
</span><span data-line="10"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span data-line="11"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a temporary download URL.&quot;&quot;&quot;</span>
</span><span data-line="12">    <span class="n">url</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">expires_in</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>
</span><span data-line="13">    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;download_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;expires_in&quot;</span><span class="p">:</span> <span class="s2">&quot;30 minutes&quot;</span><span class="p">}</span>
</span><span data-line="14">
</span><span data-line="15">
</span><span data-line="16"><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/files/{key:path}/download&quot;</span><span class="p">)</span>
</span><span data-line="17"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_file</span><span class="p">(</span>
</span><span data-line="18">    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="19">    <span class="n">storage</span><span class="p">:</span> <span class="n">Storage</span><span class="p">,</span>
</span><span data-line="20"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Redirect</span><span class="p">:</span>
</span><span data-line="21"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Redirect to SAS URL for download.&quot;&quot;&quot;</span>
</span><span data-line="22">    <span class="n">url</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">expires_in</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
</span><span data-line="23">    <span class="k">return</span> <span class="n">Redirect</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Note:</strong> SAS URL generation requires an account key. It does not work with managed identity alone.</p>
</section>
<section id="using-with-prefix">
<h3>Using with Prefix<a class="headerlink" href="#using-with-prefix" title="Link to this heading">¶</a></h3>
<p>Organize files within a container using prefixes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># All operations prefixed with &quot;app-name/uploads/&quot;</span>
</span><span data-line="2"><span class="n">storage</span> <span class="o">=</span> <span class="n">AzureStorage</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">config</span><span class="o">=</span><span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="4">        <span class="n">container</span><span class="o">=</span><span class="s2">&quot;shared-container&quot;</span><span class="p">,</span>
</span><span data-line="5">        <span class="n">connection_string</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
</span><span data-line="6">        <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;app-name/uploads/&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="p">)</span>
</span><span data-line="8"><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Stores at: app-name/uploads/images/photo.jpg</span>
</span><span data-line="11"><span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;images/photo.jpg&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># Lists only files under the prefix</span>
</span><span data-line="14"><span class="k">async</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">storage</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="s2">&quot;images/&quot;</span><span class="p">):</span>
</span><span data-line="15">    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>  <span class="c1"># Returns &quot;images/photo.jpg&quot;, not full path</span>
</span></pre></div>
</div>
<p>Use cases for prefixes:</p>
<ul class="simple">
<li><p>Multiple applications sharing a container</p></li>
<li><p>Environment separation (production/, staging/)</p></li>
<li><p>Tenant isolation in multi-tenant applications</p></li>
</ul>
</section>
<section id="streaming-large-files">
<h3>Streaming Large Files<a class="headerlink" href="#streaming-large-files" title="Link to this heading">¶</a></h3>
<p>Stream files directly from Azure without loading entirely into memory:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">Stream</span>
</span><span data-line="3">
</span><span data-line="4">
</span><span data-line="5"><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/files/{key:path}&quot;</span><span class="p">)</span>
</span><span data-line="6"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stream_file</span><span class="p">(</span>
</span><span data-line="7">    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">storage</span><span class="p">:</span> <span class="n">Storage</span><span class="p">,</span>
</span><span data-line="9"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Stream</span><span class="p">:</span>
</span><span data-line="10"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Stream a file directly from Azure.&quot;&quot;&quot;</span>
</span><span data-line="11">    <span class="n">info</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13">    <span class="k">return</span> <span class="n">Stream</span><span class="p">(</span>
</span><span data-line="14">        <span class="n">storage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
</span><span data-line="15">        <span class="n">media_type</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">content_type</span> <span class="ow">or</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">,</span>
</span><span data-line="16">        <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="17">            <span class="s2">&quot;Content-Length&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
</span><span data-line="18">            <span class="s2">&quot;Content-Disposition&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;attachment; filename=&quot;</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
</span><span data-line="19">        <span class="p">},</span>
</span><span data-line="20">    <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="copy-and-move-operations">
<h3>Copy and Move Operations<a class="headerlink" href="#copy-and-move-operations" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">archive_file</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">storage</span><span class="p">:</span> <span class="n">Storage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StoredFile</span><span class="p">:</span>
</span><span data-line="2"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Copy a file to the archive folder.&quot;&quot;&quot;</span>
</span><span data-line="3">    <span class="k">return</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;active/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;archive/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="4">
</span><span data-line="5">
</span><span data-line="6"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">publish_draft</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">storage</span><span class="p">:</span> <span class="n">Storage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StoredFile</span><span class="p">:</span>
</span><span data-line="7"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Move a file from drafts to published.&quot;&quot;&quot;</span>
</span><span data-line="8">    <span class="k">return</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;drafts/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;published/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="azurite-emulator-setup">
<h2>Azurite Emulator Setup<a class="headerlink" href="#azurite-emulator-setup" title="Link to this heading">¶</a></h2>
<p>Azurite is the official Azure Storage emulator for local development.</p>
<section id="docker-setup">
<h3>Docker Setup<a class="headerlink" href="#docker-setup" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Run Azurite with persistent storage</span>
</span><span data-line="2">docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">    </span>--name<span class="w"> </span>azurite<span class="w"> </span><span class="se">\</span>
</span><span data-line="4"><span class="w">    </span>-p<span class="w"> </span><span class="m">10000</span>:10000<span class="w"> </span><span class="se">\</span>
</span><span data-line="5"><span class="w">    </span>-p<span class="w"> </span><span class="m">10001</span>:10001<span class="w"> </span><span class="se">\</span>
</span><span data-line="6"><span class="w">    </span>-p<span class="w"> </span><span class="m">10002</span>:10002<span class="w"> </span><span class="se">\</span>
</span><span data-line="7"><span class="w">    </span>-v<span class="w"> </span>azurite-data:/data<span class="w"> </span><span class="se">\</span>
</span><span data-line="8"><span class="w">    </span>mcr.microsoft.com/azure-storage/azurite
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Create a container (using Azure CLI)</span>
</span><span data-line="11">az<span class="w"> </span>storage<span class="w"> </span>container<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span data-line="12"><span class="w">    </span>--name<span class="w"> </span>test-container<span class="w"> </span><span class="se">\</span>
</span><span data-line="13"><span class="w">    </span>--connection-string<span class="w"> </span><span class="s2">&quot;DefaultEndpointsProtocol=http;AccountName=devstoreaccount1;AccountKey=Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==;BlobEndpoint=http://127.0.0.1:10000/devstoreaccount1&quot;</span>
</span></pre></div>
</div>
</section>
<section id="docker-compose">
<h3>Docker Compose<a class="headerlink" href="#docker-compose" title="Link to this heading">¶</a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.8&quot;</span>
</span><span data-line="2">
</span><span data-line="3"><span class="nt">services</span><span class="p">:</span>
</span><span data-line="4"><span class="w">  </span><span class="nt">azurite</span><span class="p">:</span>
</span><span data-line="5"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mcr.microsoft.com/azure-storage/azurite</span>
</span><span data-line="6"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span data-line="7"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10000:10000&quot;</span><span class="w">  </span><span class="c1"># Blob service</span>
</span><span data-line="8"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10001:10001&quot;</span><span class="w">  </span><span class="c1"># Queue service</span>
</span><span data-line="9"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;10002:10002&quot;</span><span class="w">  </span><span class="c1"># Table service</span>
</span><span data-line="10"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span data-line="11"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azurite-data:/data</span>
</span><span data-line="12"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;azurite</span><span class="nv"> </span><span class="s">--blobHost</span><span class="nv"> </span><span class="s">0.0.0.0</span><span class="nv"> </span><span class="s">--queueHost</span><span class="nv"> </span><span class="s">0.0.0.0</span><span class="nv"> </span><span class="s">--tableHost</span><span class="nv"> </span><span class="s">0.0.0.0&quot;</span>
</span><span data-line="13">
</span><span data-line="14"><span class="nt">volumes</span><span class="p">:</span>
</span><span data-line="15"><span class="w">  </span><span class="nt">azurite-data</span><span class="p">:</span>
</span></pre></div>
</div>
</section>
<section id="azurite-configuration">
<h3>Azurite Configuration<a class="headerlink" href="#azurite-configuration" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Development configuration</span>
</span><span data-line="4"><span class="n">AZURITE_CONNECTION_STRING</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="5">    <span class="s2">&quot;DefaultEndpointsProtocol=http;&quot;</span>
</span><span data-line="6">    <span class="s2">&quot;AccountName=devstoreaccount1;&quot;</span>
</span><span data-line="7">    <span class="s2">&quot;AccountKey=Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==;&quot;</span>
</span><span data-line="8">    <span class="s2">&quot;BlobEndpoint=http://127.0.0.1:10000/devstoreaccount1&quot;</span>
</span><span data-line="9"><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Use environment to switch between local and production</span>
</span><span data-line="12"><span class="k">def</span><span class="w"> </span><span class="nf">get_storage</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AzureStorage</span><span class="p">:</span>
</span><span data-line="13">    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ENVIRONMENT&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;production&quot;</span><span class="p">:</span>
</span><span data-line="14">        <span class="k">return</span> <span class="n">AzureStorage</span><span class="p">(</span>
</span><span data-line="15">            <span class="n">config</span><span class="o">=</span><span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="16">                <span class="n">container</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_STORAGE_CONTAINER&quot;</span><span class="p">],</span>
</span><span data-line="17">                <span class="n">account_url</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_STORAGE_ACCOUNT_URL&quot;</span><span class="p">],</span>
</span><span data-line="18">            <span class="p">)</span>
</span><span data-line="19">        <span class="p">)</span>
</span><span data-line="20">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="21">        <span class="k">return</span> <span class="n">AzureStorage</span><span class="p">(</span>
</span><span data-line="22">            <span class="n">config</span><span class="o">=</span><span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="23">                <span class="n">container</span><span class="o">=</span><span class="s2">&quot;test-container&quot;</span><span class="p">,</span>
</span><span data-line="24">                <span class="n">connection_string</span><span class="o">=</span><span class="n">AZURITE_CONNECTION_STRING</span><span class="p">,</span>
</span><span data-line="25">            <span class="p">)</span>
</span><span data-line="26">        <span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">¶</a></h2>
<section id="credential-management">
<h3>Credential Management<a class="headerlink" href="#credential-management" title="Link to this heading">¶</a></h3>
<p><strong>Credential Hierarchy:</strong></p>
<p>AzureStorage uses credentials in this order:</p>
<ol class="arabic simple">
<li><p>Explicit <code class="docutils literal notranslate"><span class="pre">connection_string</span></code> in config</p></li>
<li><p>Explicit <code class="docutils literal notranslate"><span class="pre">account_url</span></code> + <code class="docutils literal notranslate"><span class="pre">account_key</span></code> in config</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">account_url</span></code> with DefaultAzureCredential (managed identity, environment, CLI)</p></li>
</ol>
<p><strong>Recommended approach by environment:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Environment</p></th>
<th class="head"><p>Credential Method</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Local development</p></td>
<td><p>Azurite or connection string</p></td>
</tr>
<tr class="row-odd"><td><p>CI/CD</p></td>
<td><p>Environment variables (secrets)</p></td>
</tr>
<tr class="row-even"><td><p>Azure App Service</p></td>
<td><p>Managed Identity</p></td>
</tr>
<tr class="row-odd"><td><p>Azure Functions</p></td>
<td><p>Managed Identity</p></td>
</tr>
<tr class="row-even"><td><p>Azure Kubernetes (AKS)</p></td>
<td><p>Workload Identity</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="environment-variable-configuration">
<h3>Environment Variable Configuration<a class="headerlink" href="#environment-variable-configuration" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># For connection string auth</span>
</span><span data-line="2"><span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_STORAGE_CONNECTION_STRING</span><span class="o">=</span><span class="s2">&quot;DefaultEndpointsProtocol=https;AccountName=...&quot;</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># For account URL + key auth</span>
</span><span data-line="5"><span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_STORAGE_ACCOUNT_URL</span><span class="o">=</span><span class="s2">&quot;https://myaccount.blob.core.windows.net&quot;</span>
</span><span data-line="6"><span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_STORAGE_ACCOUNT_KEY</span><span class="o">=</span><span class="s2">&quot;your-account-key&quot;</span>
</span><span data-line="7"><span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_STORAGE_CONTAINER</span><span class="o">=</span><span class="s2">&quot;my-container&quot;</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># For managed identity (DefaultAzureCredential)</span>
</span><span data-line="10"><span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_STORAGE_ACCOUNT_URL</span><span class="o">=</span><span class="s2">&quot;https://myaccount.blob.core.windows.net&quot;</span>
</span><span data-line="11"><span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_STORAGE_CONTAINER</span><span class="o">=</span><span class="s2">&quot;my-container&quot;</span>
</span><span data-line="12"><span class="c1"># No key needed - uses managed identity</span>
</span></pre></div>
</div>
</section>
<section id="never-commit-credentials">
<h3>Never Commit Credentials<a class="headerlink" href="#never-commit-credentials" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># BAD - credentials in code</span>
</span><span data-line="2"><span class="n">storage</span> <span class="o">=</span> <span class="n">AzureStorage</span><span class="p">(</span><span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">container</span><span class="o">=</span><span class="s2">&quot;my-container&quot;</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">account_key</span><span class="o">=</span><span class="s2">&quot;super-secret-key&quot;</span><span class="p">,</span>  <span class="c1"># Never do this!</span>
</span><span data-line="5"><span class="p">))</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># GOOD - credentials from environment</span>
</span><span data-line="8"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span data-line="9">
</span><span data-line="10"><span class="n">storage</span> <span class="o">=</span> <span class="n">AzureStorage</span><span class="p">(</span><span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="11">    <span class="n">container</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_STORAGE_CONTAINER&quot;</span><span class="p">],</span>
</span><span data-line="12">    <span class="n">connection_string</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;AZURE_STORAGE_CONNECTION_STRING&quot;</span><span class="p">),</span>
</span><span data-line="13"><span class="p">))</span>
</span></pre></div>
</div>
</section>
<section id="container-naming-rules">
<h3>Container Naming Rules<a class="headerlink" href="#container-naming-rules" title="Link to this heading">¶</a></h3>
<p>Azure container names must:</p>
<ul class="simple">
<li><p>Be 3-63 characters long</p></li>
<li><p>Start with a letter or number</p></li>
<li><p>Contain only lowercase letters, numbers, and hyphens</p></li>
<li><p>Not have consecutive hyphens</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Valid names</span>
</span><span data-line="2"><span class="s2">&quot;my-container&quot;</span>
</span><span data-line="3"><span class="s2">&quot;uploads2024&quot;</span>
</span><span data-line="4"><span class="s2">&quot;app-data-prod&quot;</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Invalid names</span>
</span><span data-line="7"><span class="s2">&quot;My-Container&quot;</span>      <span class="c1"># No uppercase</span>
</span><span data-line="8"><span class="s2">&quot;my--container&quot;</span>     <span class="c1"># No consecutive hyphens</span>
</span><span data-line="9"><span class="s2">&quot;-my-container&quot;</span>     <span class="c1"># Must start with letter/number</span>
</span><span data-line="10"><span class="s2">&quot;ab&quot;</span>                <span class="c1"># Too short</span>
</span></pre></div>
</div>
</section>
</section>
<section id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_storages</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="2">    <span class="n">StorageError</span><span class="p">,</span>
</span><span data-line="3">    <span class="n">StorageFileNotFoundError</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">ConfigurationError</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">StorageConnectionError</span><span class="p">,</span>
</span><span data-line="6"><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8">
</span><span data-line="9"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">safe_download</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">storage</span><span class="p">:</span> <span class="n">Storage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="10"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Download a file with error handling.&quot;&quot;&quot;</span>
</span><span data-line="11">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="12">        <span class="k">return</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">get_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="13">    <span class="k">except</span> <span class="n">StorageFileNotFoundError</span><span class="p">:</span>
</span><span data-line="14">        <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="15">    <span class="k">except</span> <span class="n">StorageConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="16">        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="17">        <span class="k">raise</span>
</span><span data-line="18">    <span class="k">except</span> <span class="n">StorageError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="19">        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storage error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="20">        <span class="k">raise</span>
</span><span data-line="21">
</span><span data-line="22">
</span><span data-line="23"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">safe_delete</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">storage</span><span class="p">:</span> <span class="n">Storage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="24"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a file, returning False if it doesn&#39;t exist.&quot;&quot;&quot;</span>
</span><span data-line="25">    <span class="c1"># Note: Azure delete raises an error for non-existent blobs</span>
</span><span data-line="26">    <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span><span data-line="27">        <span class="k">return</span> <span class="kc">False</span>
</span><span data-line="28">    <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="29">    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>
</div>
<section id="common-error-scenarios">
<h3>Common Error Scenarios<a class="headerlink" href="#common-error-scenarios" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Error</p></th>
<th class="head"><p>Cause</p></th>
<th class="head"><p>Solution</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ConfigurationError</span></code></p></td>
<td><p>Missing container name or credentials</p></td>
<td><p>Check config parameters</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">StorageConnectionError</span></code></p></td>
<td><p>Network issues or invalid endpoint</p></td>
<td><p>Verify account URL and network</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">StorageFileNotFoundError</span></code></p></td>
<td><p>Blob does not exist</p></td>
<td><p>Check key and prefix</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">StorageError</span></code> (with “AuthenticationFailed”)</p></td>
<td><p>Invalid credentials</p></td>
<td><p>Verify account key or connection string</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="azure-specific-considerations">
<h2>Azure-Specific Considerations<a class="headerlink" href="#azure-specific-considerations" title="Link to this heading">¶</a></h2>
<section id="delete-behavior">
<h3>Delete Behavior<a class="headerlink" href="#delete-behavior" title="Link to this heading">¶</a></h3>
<p>Unlike S3 and GCS, Azure Blob Storage raises an error when deleting a non-existent blob. Use <code class="docutils literal notranslate"><span class="pre">exists()</span></code> first for idempotent deletes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">idempotent_delete</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">storage</span><span class="p">:</span> <span class="n">Storage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a file without raising if it doesn&#39;t exist.&quot;&quot;&quot;</span>
</span><span data-line="3">    <span class="k">if</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span><span data-line="4">        <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="sas-url-limitations">
<h3>SAS URL Limitations<a class="headerlink" href="#sas-url-limitations" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>SAS URLs require an account key (cannot be generated with managed identity alone)</p></li>
<li><p>For managed identity scenarios, consider using Azure CDN with private endpoints</p></li>
<li><p>SAS tokens should be short-lived for security</p></li>
</ul>
</section>
<section id="blob-types">
<h3>Blob Types<a class="headerlink" href="#blob-types" title="Link to this heading">¶</a></h3>
<p>AzureStorage uses block blobs, which are suitable for most file storage scenarios. For append-only logs or page blobs (VHDs), you would need direct Azure SDK usage.</p>
</section>
</section>
<section id="large-file-uploads">
<h2>Large File Uploads<a class="headerlink" href="#large-file-uploads" title="Link to this heading">¶</a></h2>
<p>For files larger than 100MB, use <code class="docutils literal notranslate"><span class="pre">put_large()</span></code> or the manual multipart upload API. Azure implements multipart uploads using Block Blobs, where blocks are staged individually and then committed as a single blob.</p>
<section id="using-put-large">
<h3>Using put_large()<a class="headerlink" href="#using-put-large" title="Link to this heading">¶</a></h3>
<p>The simplest way to upload large files with automatic chunking and progress tracking:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_storages</span><span class="w"> </span><span class="kn">import</span> <span class="n">AzureStorage</span><span class="p">,</span> <span class="n">AzureConfig</span><span class="p">,</span> <span class="n">ProgressInfo</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">storage</span> <span class="o">=</span> <span class="n">AzureStorage</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="5">        <span class="n">container</span><span class="o">=</span><span class="s2">&quot;my-container&quot;</span><span class="p">,</span>
</span><span data-line="6">        <span class="n">connection_string</span><span class="o">=</span><span class="s2">&quot;DefaultEndpointsProtocol=https;...&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="p">)</span>
</span><span data-line="8"><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Upload a large file with automatic chunking</span>
</span><span data-line="11"><span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">put_large</span><span class="p">(</span>
</span><span data-line="12">    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;backups/database-dump.sql.gz&quot;</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">data</span><span class="o">=</span><span class="n">large_file_bytes</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/gzip&quot;</span><span class="p">,</span>
</span><span data-line="15">    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;daily-backup&quot;</span><span class="p">},</span>
</span><span data-line="16">    <span class="n">part_size</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 4MB blocks (Azure default)</span>
</span><span data-line="17"><span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uploaded </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> bytes to </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="progress-tracking">
<h3>Progress Tracking<a class="headerlink" href="#progress-tracking" title="Link to this heading">¶</a></h3>
<p>Monitor upload progress with a callback function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_storages</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProgressInfo</span>
</span><span data-line="2">
</span><span data-line="3">
</span><span data-line="4"><span class="k">def</span><span class="w"> </span><span class="nf">show_progress</span><span class="p">(</span><span class="n">info</span><span class="p">:</span> <span class="n">ProgressInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Display upload progress.&quot;&quot;&quot;</span>
</span><span data-line="6">    <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">percentage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="7">        <span class="n">bar_length</span> <span class="o">=</span> <span class="mi">40</span>
</span><span data-line="8">        <span class="n">filled</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bar_length</span> <span class="o">*</span> <span class="n">info</span><span class="o">.</span><span class="n">percentage</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span data-line="9">        <span class="n">bar</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="n">filled</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">bar_length</span> <span class="o">-</span> <span class="n">filled</span><span class="p">)</span>
</span><span data-line="10">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">[</span><span class="si">{</span><span class="n">bar</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">percentage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12">
</span><span data-line="13"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">upload_with_progress</span><span class="p">(</span><span class="n">storage</span><span class="p">:</span> <span class="n">AzureStorage</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="14"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Upload a large file with progress display.&quot;&quot;&quot;</span>
</span><span data-line="15">    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">put_large</span><span class="p">(</span>
</span><span data-line="16">        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
</span><span data-line="17">        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
</span><span data-line="18">        <span class="n">progress_callback</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span>
</span><span data-line="19">    <span class="p">)</span>
</span><span data-line="20">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Complete! Uploaded </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># Usage</span>
</span><span data-line="24"><span class="k">await</span> <span class="n">upload_with_progress</span><span class="p">(</span><span class="n">storage</span><span class="p">,</span> <span class="s2">&quot;videos/presentation.mp4&quot;</span><span class="p">,</span> <span class="n">video_data</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="manual-multipart-upload">
<h3>Manual Multipart Upload<a class="headerlink" href="#manual-multipart-upload" title="Link to this heading">¶</a></h3>
<p>For fine-grained control over the upload process:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">litestar_storages</span><span class="w"> </span><span class="kn">import</span> <span class="n">AzureStorage</span><span class="p">,</span> <span class="n">AzureConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">storage</span> <span class="o">=</span> <span class="n">AzureStorage</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">AzureConfig</span><span class="p">(</span>
</span><span data-line="5">        <span class="n">container</span><span class="o">=</span><span class="s2">&quot;my-container&quot;</span><span class="p">,</span>
</span><span data-line="6">        <span class="n">connection_string</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="p">)</span>
</span><span data-line="8"><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Step 1: Start the upload</span>
</span><span data-line="11"><span class="n">upload</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">start_multipart_upload</span><span class="p">(</span>
</span><span data-line="12">    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;large-archive.tar.gz&quot;</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/gzip&quot;</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;created-by&quot;</span><span class="p">:</span> <span class="s2">&quot;backup-service&quot;</span><span class="p">},</span>
</span><span data-line="15">    <span class="n">part_size</span><span class="o">=</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 8MB blocks</span>
</span><span data-line="16"><span class="p">)</span>
</span><span data-line="17">
</span><span data-line="18"><span class="c1"># Step 2: Upload blocks</span>
</span><span data-line="19"><span class="n">block_size</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
</span><span data-line="20"><span class="n">data</span> <span class="o">=</span> <span class="n">load_large_file</span><span class="p">()</span>
</span><span data-line="21">
</span><span data-line="22"><span class="k">try</span><span class="p">:</span>
</span><span data-line="23">    <span class="k">for</span> <span class="n">part_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">//</span> <span class="n">block_size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
</span><span data-line="24">        <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">part_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">block_size</span>
</span><span data-line="25">        <span class="n">block_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="n">block_size</span><span class="p">]</span>
</span><span data-line="26">        <span class="k">if</span> <span class="ow">not</span> <span class="n">block_data</span><span class="p">:</span>
</span><span data-line="27">            <span class="k">break</span>
</span><span data-line="28">
</span><span data-line="29">        <span class="n">block_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">upload_part</span><span class="p">(</span><span class="n">upload</span><span class="p">,</span> <span class="n">part_num</span><span class="p">,</span> <span class="n">block_data</span><span class="p">)</span>
</span><span data-line="30">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uploaded block </span><span class="si">{</span><span class="n">part_num</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">block_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="31">
</span><span data-line="32">    <span class="c1"># Step 3: Commit the block list</span>
</span><span data-line="33">    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">complete_multipart_upload</span><span class="p">(</span><span class="n">upload</span><span class="p">)</span>
</span><span data-line="34">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Upload complete: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="35">
</span><span data-line="36"><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="37">    <span class="c1"># Azure auto-cleans uncommitted blocks after 7 days</span>
</span><span data-line="38">    <span class="c1"># Explicit abort is optional but releases tracking resources</span>
</span><span data-line="39">    <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">abort_multipart_upload</span><span class="p">(</span><span class="n">upload</span><span class="p">)</span>
</span><span data-line="40">    <span class="k">raise</span>
</span></pre></div>
</div>
</section>
<section id="azure-block-blob-limits">
<h3>Azure Block Blob Limits<a class="headerlink" href="#azure-block-blob-limits" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Limit</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Maximum blocks per blob</p></td>
<td><p>50,000</p></td>
</tr>
<tr class="row-odd"><td><p>Maximum block size</p></td>
<td><p>4000 MB</p></td>
</tr>
<tr class="row-even"><td><p>Maximum blob size</p></td>
<td><p>~190 TB</p></td>
</tr>
<tr class="row-odd"><td><p>Block ID length</p></td>
<td><p>Must be consistent across all blocks</p></td>
</tr>
<tr class="row-even"><td><p>Uncommitted block lifetime</p></td>
<td><p>7 days (auto-cleanup)</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="block-size-recommendations">
<h3>Block Size Recommendations<a class="headerlink" href="#block-size-recommendations" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>File Size</p></th>
<th class="head"><p>Recommended Block Size</p></th>
<th class="head"><p>Reasoning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>100MB - 1GB</p></td>
<td><p>4MB (default)</p></td>
<td><p>Good parallelism, reasonable overhead</p></td>
</tr>
<tr class="row-odd"><td><p>1GB - 10GB</p></td>
<td><p>8-16MB</p></td>
<td><p>Fewer blocks to manage</p></td>
</tr>
<tr class="row-even"><td><p>10GB+</p></td>
<td><p>32-64MB</p></td>
<td><p>Minimize API calls</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Adjust block size based on file size</span>
</span><span data-line="2"><span class="k">def</span><span class="w"> </span><span class="nf">get_optimal_block_size</span><span class="p">(</span><span class="n">file_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span data-line="3"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate optimal block size for Azure uploads.&quot;&quot;&quot;</span>
</span><span data-line="4">    <span class="k">if</span> <span class="n">file_size</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># &lt; 1GB</span>
</span><span data-line="5">        <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 4MB</span>
</span><span data-line="6">    <span class="k">elif</span> <span class="n">file_size</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># &lt; 10GB</span>
</span><span data-line="7">        <span class="k">return</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 16MB</span>
</span><span data-line="8">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="9">        <span class="k">return</span> <span class="mi">64</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 64MB</span>
</span><span data-line="10">
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># Usage</span>
</span><span data-line="13"><span class="n">block_size</span> <span class="o">=</span> <span class="n">get_optimal_block_size</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span data-line="14"><span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">put_large</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">part_size</span><span class="o">=</span><span class="n">block_size</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Learn about <a class="reference internal" href="memory.html"><span class="std std-doc">Memory storage</span></a> for testing Azure code without Azure</p></li>
<li><p>Explore <a class="reference internal" href="filesystem.html"><span class="std std-doc">Filesystem storage</span></a> for local development</p></li>
<li><p>Create <a class="reference internal" href="../advanced/custom-backends.html"><span class="std std-doc">custom backends</span></a> for other cloud providers</p></li>
</ul>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="gcs.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">GCS Storage</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="memory.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Memory Storage</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, Jacob Coffee</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/JacobCoffee/litestar-storages" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=30646c52"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=c1cf1a6b"></script></body>
</html>